# 2. Core Image Filters in Detail
Core Imageì˜ ê´‘ë²”ìœ„í•œ ì´ë¯¸ì§€ í•„í„°ëŠ” ë„“ì€ ë²”ìœ„ì˜ ì‹œê°ì  íš¨ê³¼ë¥¼ í¬í•¨í•œë‹¤.

### Interrogating the Filter
- `inputKey`ëŠ”  arrayë¡œ êµ¬ì„±ë˜ì–´ ìžˆë‹¤.
```swift
inputKeys:[String] = {"inputImage", "inputCenter", "inputWidth", "inputAngle", "inputSharpness", "inputGCR", "inputUCR"}
```
- `attributes`ë¥¼ ê°€ì§€ê³  dictionaryë¡œ êµ¬ì„±ë˜ì–´ ìžˆê³  ìš°ë¦¬ê°€ ìœ ì € ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ êµ¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ì¤€ë‹¤.

	>Core Image Filterì˜ 	parameters
	- ëŒ€ë¶€ë¶„ CIColor, CIImage, CIVector, NSNumberë¡œ í•´ê²°ëœë‹¤.
	
	1. CIColor - a Core Image Color
	2. CIImage - a Core Image image
	3. CIVector - ìž„ì˜ì˜ ê¸¸ì´ì˜ CGFloatì˜ vector. `CIAttributeDefalt`ì˜ ì‚¬ì´ì¦ˆë¥¼ ë³¼ ìˆ˜ ìžˆë‹¤.
	4. NSData - `CIQRCodeGenerator`, `inputCubeData`ì™€ ê°™ì€ ì½”ë“œ ë°œìƒì—ì„œ ì‚¬ìš©ëœë‹¤.
	5. NSNumber - Swiftì˜ ì–´ë–¤ ìˆ«ìž íƒ€ìž…ë„ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
	6. NSObject - `CIColorCubeWithColorSpace`ì˜ `inputColorSpace`ì— ì‚¬ìš©ëœë‹¤.
	7. NSString - `inputCorrectionLevel`ë¥¼ L, M, Q, H ì¤‘ì—ì„œ ì •ì˜í•˜ëŠ” ë°ì— `CIQRCodeGenerator`ë¡œ ì‚¬ìš©ëœë‹¤.
	8. NSValue - Affine transform filterì—ì„œ `inputTransform`ë¡œ ì‚¬ìš©ëœë‹¤.

## Filter Category
- Filterë“¤ì€ íš¨ê³¼ì— ë”°ë¼ ì¹´í…Œê³ ë¦¬ê°€ ë‚˜ë‰˜ì–´ì ¸ ìžˆë‹¤. ì¦‰, filterëŠ” ì ì–´ë„ í•˜ë‚˜ ì´ìƒì˜ íš¨ê³¼ì— ì†í•´ì ¸ ìžˆë‹¤.
- ëŒ€ë¶€ë¶„ì˜ í•„í„°ë“¤ì€ `kCICategoryStillImage` ë˜ëŠ” `kCICategoryHighDynamicRange`ì— ì†í•´ì ¸ ìžˆë‹¤.


### 1. Blur

> kCICategoryBlur

- ì´ë¯¸ì§€ë¥¼ soften, smooth out ì‹œí‚¨ë‹¤.
- Gaussian blueì™€ noiseë¥¼ ì¤„ì´ê³  blur ë°©í–¥ì„±ì„ í¬í•¨í•˜ê³  ìžˆë‹¤.

###2. Color Adjustment

> kCICategoryColorAdustment

- ì´ë¯¸ì§€ì—ì„œ color valueë¥¼ ë°”ê¾¼ë‹¤.
- hue, exposure, gamma, white pointê°€ ì†í•´ì ¸ìžˆë‹¤.

### 3. Color Effect

> kCICategoryColorEffect

- artistic ì´ë¯¸ì§€ í•„í„°ë¥¼ ì œê³µí•œë‹¤.
- ë³´ìƒ‰(false color), vignetteê°€ ì†í•´ì ¸ ìžˆë‹¤.

### 4. Composite Operation
> kCICategoryCompositeOperation

-  í•©ì„±, blend modeë¥¼ í¬í•¨í•˜ê³  ìžˆë‹¤. ë‘ê°€ì§€ ì´ë¯¸ì§€ë¥¼ ê°ê°  color valueë¥¼ ë°”ê¾¸ê±°ë‚˜í•´ì„œ í•©ì¹œë‹¤.

###5. Distortion

> kCICategoryDistortionEffect

-  ì´ë¯¸ì§€ë¥¼ ê¸°í•˜í•™ì ìœ¼ë¡œ ë°”ê¾¸ê±°ë‚˜, í…ìŠ¤ì³ë¥¼ ë°”ê¾¸ê±°ë‚˜ bulging, warping ì‹œí‚¨ë‹¤.

###5. Generator
> kCICtegoryGenerator

- input image ì—†ì´ ìƒˆ ì´ë¯¸ì§€ë¥¼ ë§Œë“ ë‹¤.
- solid color, stripe, checkerboardê°€ ì†í•˜ê³  random noise, leticular halos, sunbeams, star shineì„ ì–¹ì„ ìˆ˜ ìžˆë‹¤.

###6. Geomtry Adjustment
> kCICategoryGeomtryAdjustment

- ì„¸ìš°ê±°ë‚˜ scaleì„ ì¡°ì •í•  ë¿ë§Œì•„ë‹ˆë¼ ì •í™•í•œ ì›ê·¼ì„ ë‚´ì„¸ìš´ë‹¤.

###7. Gradient
> kCICategoryGradient

- ë‘ê°€ì§€ ìƒ‰ì„ ì„ í˜• ë˜ëŠ” ì›í˜•ìœ¼ë¡œ ê·¸ë¼ë””ì–¸íŠ¸ íš¨ê³¼ë¥¼ ì¤€ë‹¤.

###8. Halftone Effect
> kCICategoryHalftoneEffect

- CMYK halftone, monochrome halftoneì´ í¬í•¨.

###9. Reduction
> kCICtegoryReduction

- historgramì„ ë³´ì—¬ì¤€ë‹¤.

###10. Sharpen
> kCICategorySharpen

- edge ì‚¬ì´ì—ì„œ ëŒ€ë¹„ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë‘ê°€ì§€ì˜ í•„í„°ê°€ ìžˆë‹¤. `sharpen luminance`, `unsharp mask`

###11. Stylize
> kCICategoryStylize

- line overlay, edge detection

###12. Tile Effect
> kCICategoryTileEffect

###13. Transition
> kCICategoryTransition

## Creating & Applying Filters
### 1. Creating Filters

1. input ë  CIImage ìƒìˆ˜ ë§Œë“¤ê¸°.

	```swift
	let carMascot = CIImage(image: UIImage(named: "carmascot.jpg")!)!
	```
2-1. filterì˜ instanceë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— í•„ìš”í•œ parameterë¥¼ ë„£ëŠ”ë‹¤.
	
	```swift
	let bloomFilter = CIFilter(name: "CIBloom")!
	
	bloomFilter.setValue(8, forKey: kCIInputRadiusKey)
	bloomFilter.setValue(1.25, forKey: kCIInputIntensityKey)
	bloomFilter.setValue(carMascot, forKey: kCIInputImageKey)
	```
2-2. output imageë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
	```swift
	let finalImage = bloomFilter.valueForKey(kCIOutputImageKey) as! CIImage
	```

	ðŸ’¡2-1ê³¼ 2-2ë¥¼ í•œ ë²ˆì— ì§„í–‰í•  ìˆ˜ ìžˆë‹¤.
		```swift
		let finalImage = carMascot.imageApplyingFilter("CIBloom", withInputParameters: [kCIInputRdiusKey: 8, kCIInputIntensityKey: 1.25])
		```

3. UIImageë¡œ ì ìš©.
	```swift
	let image = UIImgae(CIImage: finalImage)
	```

### 2. Chaining Filters
- ì•žì˜ í•„í„°ì˜ `kCIOutputImageKey`ë¥¼ ë‹¤ìŒì— ì ìš©ë  filterì˜ `kCIInputImageKey`ë¡œ ì ìš©í•˜ë©´ ì—°ì†ì ì¸ í•„í„° ì ìš©ì´ ê°€ëŠ¥!
	
	```swift
	//ðŸ”… case 1
	let noirFilter = CIFilter(name: "CIPhotoEffectNoir")!
	noirFilter.setValue(finalImagem forKey: kCIInputImageKey)
	let finalNoirImage = noirEffect.outputImage!
	
	//ðŸ”… case 2
	let finalNoirImage = carMascot.imageByApplyingFilter("CIBloom", withInputPrameters: [kCIInputRadiusKey: 8, kCIInputIntensityKey: 1.25]).imageByApplyingFilter("CIPhotoEffectNoir", withInputParameters: nil)
	```

### 3. Composite & Blend Filters
- ë‘ë²ˆì§¸ ì´ë¯¸ì§€ì˜ í‚¤ëŠ” `kCIInputBackgroundImageKey`ì´ë‹¤. ê°™ì€ ì†ŒìŠ¤ì˜ ì´ë¯¸ì§€ëŠ” ì•ˆëœë‹¤.ðŸ˜‚
1. í•©ì„±í•  ì¤„ë¬´ëŠ¬ ì´ë¯¸ì§€ë¥¼ ë§Œë“ ë‹¤.

	```swift
	let stripesImage = CIFilter(name: "CIStripeGenerator")!.outputImage!
	```
	
2. ì¤„ë¬´ëŠ¬ì— í•©ì„±í•  carMoscot ì´ë¯¸ì§€ë¥¼ ìƒ‰ìƒë°˜ì „ ì‹œí‚¨ë‹¤.

	```swift
	let negativeImage = carMascot.imageByApplyingFilter("CIColorInvert", withInputParameters: nil)
	```
	
3. ë‘ ì´ë¯¸ì§€ë¥¼  `CIBlendWithMask` filterë¥¼ ì´ìš©í•˜ì—¬ í•©ì„±ì‹œí‚¨ë‹¤. ì´ í•„í„°ëŠ” main image, background image, mask imageê°€ í•„ìš”í•˜ë‹¤.
	```swift
	let composteImage = carMascot.imageByApplyingFilter("CIBlendWithMask", withInputParameters: [kCIInputBackgroundImageKey: negativeImage, kCIInputMaskImageKey: StripeImage])
	```

## Setting Filter Parameters
- ì£¼ëœ filter parameterëŠ” CIColor, CIImage, NSNumberì™€ ê°™ì€ íƒ€ìž…ì´ë‹¤. 

###1. CIColor
- Core Image colorëŠ” í•„í„°, gradientì— ì‚¬ìš©ëœë‹¤.
- rgbë¥¼ í†µí•´ settingí•˜ê±°ë‚˜ UIColorì—ì„œ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìžˆë‹¤.

	```swift
	//gradient yellow -> purple, use rgb color
	let inputColor0 = CIColor(red: 1, green: 1, blue: 0)
	let inputColor1 = CIColor(color: UIColor.purpleColor())
	
	let filter = CIFilter(name: "CILinearGradient", withInputParameters: ["inputColor0": inputColor, "inputColor1": inputColor1])!
	```

###2. CIImage
- ëŒ€ë¶€ë¶„ì˜ CIFilterëŠ” ì ì–´ë„ í•˜ë‚˜ì˜ input image íƒ€ìž…ì„ CIImageë¡œ ìš”êµ¬í•˜ê³  output ë˜í•œ CIImge íƒ€ìž…ì´ë‹¤.
- UIImageëŠ” ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” high level wayìž„ì— ë™ì‹œì— ê³ ì •ëœ ì‚¬ì´ì¦ˆì´ë‹¤. CIImageëŠ” image dataë„ ê°€ì§€ì§€ ì•Šì§€ë§Œ imageë¥¼ ë§Œë“¤ ìˆ˜ ìžˆëŠ” ë ˆì‹œí”¼ë¥¼ ê°€ì§€ê³  ìžˆë‹¤.
- CIImageëŠ” UIImageì™€ ë‹¬ë¦¬ ë¬´í•œì˜ ë²”ìœ„ë¥¼ ê°€ì§€ê³  ìžˆë‹¤. 
- UIImageë¡œ `init(image:)`ë¥¼ í†µí•´ CIImageë¥¼ ë§Œë“¤ë©´ optional ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤.ðŸ˜‚ `imageOrientation`ì„ ì´ìš©í•´ì•¼ í•œë‹¤.

	```swift
	let ciImage = CIImage(image:image)?.imageByApplyingOrientation(imageOrientationToTiffOrientation(image.imageOrientation))
	```
	
-  live videoë¥¼ filterë¡œ ì‚¬ìš©í•  ë•Œì—ëŠ” `pixel buffer`ë¡œë¶€í„° CIImageë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼í•œë‹¤.
	
	```swift
	let pixelBuffer = CMSampleBufferGetImageBuffer(sampleBuffer)
	let image = CIImage(CVPixelBuffer: pixelBuffer)
	```

###3. CIVector
- VectorëŠ” ì¢Œí‘œë¡œ ì‚¬ìš©ëœë‹¤.
- CGPoint, CGRectì—ì„œ CIVectorë¡œ ë±Œê¾¸ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ë‹¤.

	```swift
	//CGPoint > CIVector
	CIVector(CGPoint: CGPoint(x: 10, y: 10))
	
	//CGRect > CIVector
	CIVector(CGRect: CGRect(x: 10, y:10, width: 100, height: 100))
	```
	
- CIVectorëŠ” widthì™€ heightë¡œ ê²°ì •ë˜ì§€ë§Œ, ìž„ì˜ì˜ ì‚¬ì´ì¦ˆë¡œ ì§€ì •í•  ìˆ˜ ìžˆë‹¤. 

###4. NSData
- ë°”ì½”ë“œ, QRCodeë¥¼ í•´ì„, ì œìž‘ì— ì´ìš©.
	
	```swift
	//making barcode
	let message = "Core Image for Swift"
	let data = message.dataUsingEncoding(NSASCIIStringEncoding)!
	let filter = CIFilter(name: "CicODE128BarcodeGenerator", withInputParameters: ["inputMessage": data])!
	```

- color cube filterì—ì„œ `inputCubeData`ì—ì„œë„ ì‚¬ìš©.

###5. NSNumber

###6. NSObject
- `CIColorCubeWithColorSpace`íƒ€ìž…ì˜ parameterì—ì„œë§Œ `CGColorSpaceRef`ë¡œ ì‚¬ìš©ëœë‹¤.
	
	```swift
	let colorSpace = cgcOLORsPACEcreateDeviceRGB()!
	let colorCube = CIFilter(name: "CIColorCubeWithColorSpace", withInputParameters: [kCIInputImageKey: image, "inputColorSpace": colorSpace])
	```

###7. NSString
- `CIQRCodeGenerator`ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤. `inputCorrectionLevel`, L, M, Q, HëŠ” ì—ëŸ¬ì˜ ì •í™•ë„ë¥¼ ì •ì˜í•œë‹¤. ë§Œì•½ ì½”ë“œê°€ ì§€ì €ë¶„í•˜ê±°ë‚˜ í•˜ë©´ ì •í™•ë„ë¥¼ ë†’ì—¬ì¤€ë‹¤.
	- L = 7%
	- M = 15%
	- Q = 25%
	- H = 30%
	
	```swift
	let codeGenerator = CIFilter(name: "CIQRCodeGenerator", withInputParameters: ["inputCorrectionLevel": "L"])
	```
	
###8. NSValue
- `CIAffineTransform` filterì˜ `CGAffineTransform`ì—ì„œ ì‚¬ìš©ëœë‹¤.

## Height Filed & Shaded Material
#### Introduction
- ëŒ€ë¶€ë¶„ì˜ Core Imageì˜ filterëŠ” ë…ë¦½ì ìœ¼ë¡œ ì›€ì§ì´ì§€ë§Œ, `CIHeightFiledFromMask`, `CIShadedMaterial`í•„í„°ëŠ” í‘ë°±ì˜ ì•„íŠ¸ì›Œí¬ì—ì„œ 3d ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ê°€ë©´ì„œ ì›€ì§ì¸ë‹¤.
- í‘ë°± ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê¸°ìœ„í•´ì„œëŠ” ìš°ì„  ëª¨ë…¸í¬ë¡¬ì†ŒìŠ¤ì—ì„œ height filedë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. `height field from mask`

#### 1.  Height Field Filter
- ë°°ê²½ì„ `CIMaskToAlpha`í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ íˆ¬ëª…ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼í•œë‹¤.
	
	```swift
	let coreImageForSwift = UIImge(named:"coreImageForSwift.jpg")!
	let image = CIImage(image: coreImageForSwift)!
	
	let colorInvert = CIFilter(name: "CIColorInvert", withInputParameters:[KCIInputImageKey: image])!
	let maskToAlpha = CIFilter(name: "CIMaskToAlpha", withInputParameters: [kCIInputImageKey: colorInvert.outputImage!])!
	let heightFiled = CIFilter(name: "CIHeightFiledFromMask", withInputParameters: [kCIInputImageKey: maskToAlpha.outputImage!])!
	```

#### 2. Shaded Material Filter
- materialì´ ë  ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•´ì£¼ê³  ì ìš©í•œë‹¤.

	```swift
	let shphere = UIImage(named: "sphere.jpg")!
	
	let shadingImage = CIImage(image: sphere)!
	
	let shadedMaterial = CIFilter(name: "CIShadedMaterial", withInputParameters: [kCIInputImageKey: heightFiled.outputImage!, kCIInputShadingImageKey: shadingImage])!
	```

#### 3. Alternatives for Height Field Source
- ë§Œì•½ ì¢€ ë” ë‹¤ì´ë‚˜ë¯¹í•œ ì— ë³´ì‹±ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´! ë‹¤ì–‘í•œ ë°©ë²•ì´ ìžˆë‹¤.
	- UILabelì„ í†µí•´ í•„í„°ë¡œ UIImageë¥¼ ë§Œë“¤ì–´ë³´ê¸°.
	
		```swift
		let label = UILabel(frame: CGRect(x: 0, y:0, width: 1280, height: 320))
		labl.text = "Core Image for Swift"
		label.font = UIFont.boldSystemFontOfsize(200)
		label.adjustsFontSizeToFitWidth = true
		label.numberOfLines = 2
		
		UIGraphicsBeginImageContextWithOptions(CGSize(width: label.frame.width, height: label.frame.height),false, 1)
		
		label.layer.renderInContext(UIGraphicsGetCurrentContext()!)
		
		let textImage = UIGraphicsGetImageFromCurrentImageContext()
		
		UIGraphicsEndImageContext()
		
		let image = CIImage(image: textImage)!
		```

## Reduction Filters
- Core Imageì˜ `Reduction filter`ëŠ” ë‹¤ë¥¸ filterë“¤ê³¼ ì°¨ì´ì ì´ ìžˆë‹¤. reduction categoryëŠ” í‰ê· , ìµœëŒ€, ìµœì†Œìƒ‰ì˜ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ ì¢…í•©ì ìœ¼ë¡œ ê°–ê³ ìžˆë‹¤. 

#### Getting the Average Color of an Area
- Core Imageì˜ `CIAreaAverage`ëŠ” ì˜ì—­ì˜ í‰ê·  ìƒ‰ìƒì„ ë°˜í™˜í•œë‹¤.
	
	```swift
	let engineImage = CIImage(image: UIImage(named: "engine.jpg")!)!
	var sampleRect = CGRect(x: 200, y: 200, width:240, height: 240)
	
	let averageImageFilter = CIFilter(name: "CIAreaAverage", withInputParameters: [kCIInputImageKey: engineImage, kCIInputExtentKey: sampleExtent])!
	
	let averageImage = averagImageFilter.outputImage!
	```
	
- ìœ„ì™€ ê°™ì€ ë°©ë²•ì´ ìžˆì§€ë§Œ `averageImage(CIImageì™€ ë¹„ìŠ·)`ì—ì„œ bitmapì„ í†µí•´ rgbë¥¼ ì¶”ì¶œí•  ìˆ˜ ìžˆë‹¤.
	- `Core Image Context`ì™€ `color space`ê°€ í•„ìš”í•˜ë‹¤. color spaceëŠ” ì–´ë–»ê²Œ ìƒ‰ë“¤ì´ ë³€í™˜ë˜ê³  ë³´ì—¬ì§€ëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤.
	
	```swift
	let ciContext = CIContext()
	let colorSpace = CGColorSpaceCreateDeviceRGB()
	let totalBytes = 4
	let bitmap = calloc(totalBytes, sizeof(UInt8))
	
	ciContext.render(averageImage, toBitmap: bitmap, rowBytes: totalBytes, bounds: averageImage.extent, format: kCIFormatRGBA8, colorSpace: colorSpace)
	```
	
- `rgba`ëŠ” UInt8ë¡œ í˜•ì„±ë˜ì–´ ìžˆë‹¤. 

#### Calculating and Displaying Histograms

## Color Map Filter
#### Introduction
- `CIColorMap` filterëŠ” source imageì˜ target colorì— ê¸°ë°˜í•´ì„œ ìƒ‰ì„ remappingí•œë‹¤.
- ì´ë¯¸ì§€ì˜ ë„“ì´ëŠ” mappingí•  ìƒ‰ì˜ ìˆ˜ë¥¼ ì •í•œë‹¤. ì •í•´ì§„ ìƒ‰ì˜ ìˆ˜ë“¤ì€ `inputGradientImage` parameterë¥¼ ì§€ë‚˜ê°„ë‹¤.

	```swift
	let final = monarisaImage.imageByApplyingFilter("CIColorMap", withInputParameters: [kCIInputGradientImageKey: blueYellowWhite])
	```
	
	-  gradientì˜ ë°ì€ìƒ‰ì€ ì´ë¯¸ì§€ì˜ ë°ì€ìƒ‰ìœ¼ë¡œ, ì–´ë‘ìš´ìƒ‰ì€ ì´ë¯¸ì§€ì˜ ì–´ë‘ìš´ ë¶€ë¶„ìœ¼ë¡œ  mapping ëœë‹¤.

#### Creating a Color Map
- custom

#### Alternative Mapping Palettes
- ì˜›ë‚  personal computerì—ëŠ” ê°ê°ì˜ color paletteê°€ ìžˆì—ˆë‹¤.
- color map filterë¥¼ ì²´ì¸í™” í•´ì„œ color palatteë¥¼ ì´ìš©í•˜ì—¬ mappingì„ í•  ìˆ˜ ìžˆë‹¤. `colorMapGradientFromColors()`

	```swift
	func eightBitFromColorPalette(sourceImage sourceImage: CIImage, colors: [RGB]) -> CIImage{
		let colorMapGradient = colorMapGradientFromColors(colors)
		
		return sourceImage.imageByApplyingFilter("CIPixellate", withInputParameters: nil).imageByAppyingFilter("CIColorMap", withInputParameters: [kCIInputGradientImageKey: colorMapGradient])
	}
	```