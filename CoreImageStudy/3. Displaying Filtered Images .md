# 3. Displaying Filtered Images
## Displyaing with UIKit
#### Using UIImageView
- Use filtered image to UIImageView

	```swift
	let railroad = UIImage(named: "railroad.jpg")!
	let image = CIImage(image: railroad)!
	
	imageView.frame = CGRect(origin: CGPoint(x: 0, y: 0), size: image.extent.size)
	
	let noir = CIFilter(name: "CIPhotoEffectNoir", withInputParameters: [kCIInputImageKey: image])!
	
	imageView.image = UIImage(CIImage: noir.outputImage)!
	```

#### Generator Filters
- `CICheckerboardGenerator` 

	```swift
	let checkerboard = CIFilter(name: "CICheckerboardGenerator")!
	let checkerboardImage = checkerboard.outputImage!.imageByCroppingToRect(imageView.bounds)
	imageView.image = UIImage(CIImage: checkboardImage)
	```

#### Filters That Change Image Size
- `CIBloom`, `CIGloom`ê³¼ ê°™ì€ í•„í„°ëŠ” input imageë³´ë‹¤ output ì´ë¯¸ì§€ê°€ ëŠ˜ì–´ë‚œë‹¤. `extent`ë¥¼ ì´ìš©í•´ì„œ bound ì‹œì¼œì¤˜ì•¼í•œë‹¤.
	
	```swift
	let bloom = CIFilter(name: "CIBloom", withInputParameters: [KCIInputImageKey: image])!
	let cgImage = ciContext.createCGImage(bloom.outputImage!, fromRecet: image.extent)
	```

#### Saving an Image to File
- `UIImageWriteToSavedPhotosAlbum()`ì„ í†µí•´ í•„í„°ëœ CIImageë¥¼ ì €ìž¥í•  ìˆ˜ ìžˆë‹¤. ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì €ìž¥ë„ ê°€ëŠ¥!

	```swift
	let finalImage = UIImage(CGImage: cgImage)
	
	UIImageWriteToSavedPhotosAlbum(finalImage, self, "image:didFinishSavingWithError:contextInfo:", nil)
	```
	
- errorê°€ nilì´ë©´ ì €ìž¥ì€ ë¬¸ì œì—†ì´ ëœë‹¤.

## Displaying with OpenGL ES
- ë§Œì•½ ìœ ì €ê°€ filterì˜ parameterë¥¼ ë³€ê²½í•˜ê±°ë‚˜, real time performanceë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, live video feedë¥¼ ì‚¬ìš©í•œë‹¤ë©´ UIImage, UIImageView ë‹¨ê³„ë¥¼ ìŠ¤í‚µí•˜ê³  Appleì˜ `GLKit`ì˜ `OpenGL ES`ë¥¼ ì‚¬ìš©í•œë‹¤.
- ë‹¤ë¥¸ ì½”ë“œì— ë¹„í•´ ë…¸ë ¥ì´ ë” í•„ìš”í•˜ì§€ë§Œ ì™„ì„±ë„ ë†’ì€ ì½”ë“œì™€ UIImgeViewë§Œí¼ Core Imageë¥¼ ì‰½ê²Œ ë³´ì—¬ì¤€ë‹¤.

#### Creating Contexts
- GLKitì˜ `GLKView`ì— ë³´ì´ê¸° ìœ„í•´ `EAGL context`ë¥¼ ë§Œë“¤ì–´ì„œ CIContextë¥¼ ë§Œë“¤ë•Œ ì‚¬ìš©í•´ì•¼í•œë‹¤.

	```swift
	let eaglContext = EAGLContext(API: .OpenGLES2)
	
	lazy var ciContext:CIContext = {
									[unkowned self] in
									return CIContext(EAGLContext: self.eaglContext, options: [kCIContextWorkingColorSpace: NSNull()])
									}()
	```	

- ðŸ’¡ ì¤‘ìš”í•œ ê²ƒ ðŸ’¡
	1. `EAGL context`ë¥¼ ë§Œë“¤ë•Œ, APIë¥¼ ë Œë”ë§í•˜ëŠ” `OpenGL ES 2.0`ì„ ì‚¬ìš©.
	2. CIContextë¥¼ ë§Œë“¤ ë•Œì— 1.ì—ì„œ ë§Œë“¤ì–´ì§„ EAGL Contextë¥¼ ì‚¬ìš©. * Core Image Contextì˜ color managementë„ ë”.
 
	- CIContextëŠ”  `OpenGLES2`ë‚˜ `OpenGLES3` ë‘˜ ì¤‘ í•˜ë‚˜ë¡œ APIê°€ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìžˆë‹¤. `OpenGL ES 3.0`ì€ A7ë¶€í„°ì˜ í”„ë¡œì„¸ì„œì—ì„œ ê°€ëŠ¥í•˜ë‹¤. 

#### Creating GLKView
- .

	```swift
	lazy var glkView: GLKView = 
								{
									[unknowned self] in
									let glkView = GLKView(frame: CGRect(origin: CGPointZero, size: CGSize(width: 700, height: 150)), context: self.eaglContext)
									glkVIew.delegate = self.
									return glkView
									
								}()
	
	func glkView(view: GLKView, drawInRect rect: CGRect)
	
	view.addSubview(glkView)
	```	

- GLKViewì˜ contextì¸ `eaglContext`ëŠ” ìžê¸°ìžì‹ ê³¼ Core Image contextì—ì„œ ê³µìœ ëœë‹¤.
- GLKViewì˜ delegateë¥¼ view controller ìžì‹ ì´ë¼ê³  ì„¤ì •í•˜ëŠ”ë°, ì´ê±´ ìžê¸°ìžì‹ ì˜ ê¸°ëŠ¥ì„ í¬í•¨í•˜ëŠ” ê²ƒì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì´ë‹¤.	

#### Filtering an Image
- .

	```swift
	var filteredImage: CIImage?
	
	let catehdral = UIImage(named: "cathedral.jpg")!
	let ciCatehdral = CIImage(image: cathedral)!
	
	let filter = CIFilter(name: "CIPhotoEffectInstant", withInputParameters: [kCIInputImageKey: ciCathedral])
	
	filteredImage = filter?.outputImage
	
	glkView.setNeedsDisplay()
	```
	
	- `setNeedDisplay()`ëŠ” `glkView(_:drawInRect:)`ì˜ delegate ë©”ì†Œë“œë¡œ ì´ë¯¸ì§€ê°€ í•„í„°ë ã„· ë•Œ ë¶ˆë ¤ì§„ë‹¤.


#### Displaying the Filtered Image
- .

	```swift
	func glkView(view: GLKView, drawInRect rect: CGRect){
			guard let ciImage = filteredImage else{
			return
			}
			
			ciContext.drawImage(ciImage, inRect: CGRect(x: 0, y:0, width: glkView.drawableWidth, height: glkView.drawableHeight), fromRect: ciImage.extent)
	```
	
	- CPUì—†ì´ GPUë¥¼ í†µí•´ ë°”ë¡œ ë³´ì—¬ì§„ë‹¤.


#### Setting Image Aspect Ratio
- `inrect` ë³€ìˆ˜ë¡œ ì§€ì •!

	```swift
	extention CGRect {
	
		func aspictFitInRect(target target: CGRect) -> CGRect {
			let scale:CGFloat = {
								let scale = target.width/self.width
								return self.height*scale <= target.height?
								scale:target.height/self.height
			}()
		
		let width = self.width*scale
		let height = self.height*scale
		let x = target.midX - width/2
		let y = target.midY - height/2
		
		return CGRect(x: x, y:y, width: width, height: height)
		
		}
	
	}
	
	// in ViewController Class
	let drawableRect = CGRect(origin: CGPointZero, size: CGSize(width: glkView.drawableWidth, height: glkView.drawableHeight))
	
	let targetRect = ciImage.extent.aspectFitInRect(target: drawableRect)
	
	ciContext.drawImage(ciImage, inRect: targetRect, fromRect: ciImage.extent)
	```

#### Wrapping up Into a Single Component
- image viewë¥¼ ë§Œë“¤ê³  ê±°ê¸°ì— sub viewë¥¼ ì¶”ê°€í•´ì„œ filterì˜ output imageë¥¼ ì˜¬ë ¤ì¤€ë‹¤.

	```swift
	let imageView = OpenGLImageView()
	let cat = UIImage(named: "cat.jpg)!
	let finalImage = CIImage(image: cat)?.imageByApplyingFilter("CICrystallize", withInputParameters: [kCIInputRadiusKey: 20])
	
	imageView.image = finalImage
	```

## Displaying with Metal
#### Introduction
- `Metal`ì€ Appleì˜ high performacn GPU frameworkë¡œ CIImageë¥¼ ë³´ì´ëŠ”ë° ìµœê³ ì˜ í¼í¬ë¨¼ìŠ¤ ì†”ë£¨ì…˜ì„ ì œê³µí•œë‹¤.
- `MetalKit` 

#### A Metal Based CIImage View Class



#### Redering a CIImage